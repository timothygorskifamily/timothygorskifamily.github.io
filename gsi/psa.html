<!DOCTYPE html>
<html lang="en">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CVZG5030CZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CVZG5030CZ');
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Strategy Analyzer Prototype</title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    
    <script src="gsi-calculator.js"></script>

    <style>
        :root { --primary: #0f172a; --accent: #3b82f6; --bg: #f8fafc; --card: #ffffff; --border: #e2e8f0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: #334155; margin: 0; padding: 20px; }
        .container { max-width: 1400px; margin: auto; background: var(--card); padding: 30px; border-radius: 16px; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
        
        .nav-bar { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-bottom: 25px; 
            background: white; 
            padding: 0 20px; 
            height: 64px;
            border-bottom: 1px solid var(--border); 
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            border-radius: 8px;
        }
        
        .logo-text { font-size: 1.5rem; font-weight: 700; color: #1e3a8a; letter-spacing: -0.02em; text-decoration: none; }
        .logo-dot { color: #d97706; }

        .nav-links { display: flex; gap: 30px; }
        .nav-link { text-decoration: none; color: #4b5563; font-weight: 500; font-size: 0.95rem; transition: color 0.2s; }
        .nav-link:hover { color: #1e40af; }
        .nav-link.active { color: #1e40af; font-weight: 600; }

        .header { display: flex; justify-content: space-between; align-items: flex-end; border-bottom: 2px solid var(--border); padding-bottom: 20px; margin-bottom: 25px; }
        h1 { margin: 0; font-size: 1.8rem; color: var(--primary); letter-spacing: -0.5px; }
        .sub { font-size: 0.95rem; color: #64748b; margin-top: 5px; font-weight: 500; }
        
        .net-badge { background: #dcfce7; color: #166534; padding: 6px 12px; border-radius: 6px; font-weight: 800; font-size: 0.8rem; text-transform: uppercase; display: inline-block; margin-right: 10px; }
        .gross-badge { background: #f1f5f9; color: #64748b; padding: 6px 12px; border-radius: 6px; font-weight: 800; font-size: 0.8rem; text-transform: uppercase; display: inline-block; margin-right: 10px; }

        .kpi-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; margin-bottom: 30px; }
        .kpi { background: #f1f5f9; padding: 15px; border-radius: 12px; border: 1px solid var(--border); text-align: center; display: flex; flex-direction: column; justify-content: center; }
        .kpi.highlight { background: var(--primary); color: white; border: none; }
        .kpi.highlight .kpi-lbl { color: #94a3b8; }
        .kpi-val { font-size: 1.3rem; font-weight: 800; margin: 5px 0; }
        .kpi-subval { font-size: 0.85rem; font-weight: 600; opacity: 0.9; }
        .kpi-lbl { font-size: 0.7rem; text-transform: uppercase; font-weight: 700; color: #64748b; }
        
        .dashboard { display: grid; grid-template-columns: 300px 1fr; gap: 30px; }
        .controls { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 20px; height: fit-content; }
        
        .fee-section { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; margin-top: 20px; margin-bottom: 20px; }
        .fee-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .fee-title { font-weight: 700; font-size: 0.9rem; color: #334155; }
        
        .switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 22px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent); }
        input:checked + .slider:before { transform: translateX(18px); }

        .inp-grp { margin-bottom: 20px; }
        .inp-header { display: flex; justify-content: space-between; margin-bottom: 8px; align-items: center; }
        .inp-grp label { display: block; font-size: 0.85rem; font-weight: 600; color: #475569; margin: 0; }
        .inp-val { font-size: 0.85rem; font-weight: 700; color: var(--accent); }
        
        select { width: 100%; padding: 8px; border: 1px solid #cbd5e1; border-radius: 6px; font-weight: 600; background: white; }
        input[type=range] { width: 100%; -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: var(--accent); cursor: pointer; margin-top: -6px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 2px; }
        input[type=number], input[type=date] { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; font-size: 1rem; font-weight: 600; box-sizing: border-box; }

        .chart-container { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 15px; position: relative; height: 600px; }
        .chart-tools { position: absolute; top: 15px; right: 15px; z-index: 10; }
        .btn-mini { background: #eff6ff; border: 1px solid #bfdbfe; padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 700; cursor: pointer; color: var(--accent); }
        
        table { width: 100%; border-collapse: collapse; margin-top: 30px; font-size: 0.9rem; }
        th { text-align: right; padding: 12px; background: #f8fafc; color: #64748b; font-weight: 600; border-bottom: 2px solid var(--border); }
        th:first-child { text-align: left; }
        td { padding: 12px; text-align: right; border-bottom: 1px solid var(--border); font-family: 'SF Mono', monospace; }
        td:first-child { text-align: left; font-family: inherit; font-weight: 600; color: var(--primary); }

        /* --- ADDED: Modal CSS Only --- */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 5% auto; padding: 25px; border: 1px solid #888; width: 85%; max-width: 1000px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: black; }
        .hist-grid { display: grid; grid-template-columns: 250px 1fr; gap: 30px; }
        .asset-btn { width: 100%; text-align: left; padding: 12px 15px; margin-bottom: 8px; border: 1px solid #e2e8f0; border-radius: 8px; background: white; cursor: pointer; transition: 0.2s; font-weight: 600; display: flex; justify-content: space-between; }
        .asset-btn:hover { background: #f8fafc; }
        .asset-btn.active { background: #eff6ff; border-color: var(--accent); color: var(--accent); }
        .asset-ret { font-weight: 800; }
    </style>
</head>
<body>

<div class="container">
    <nav class="nav-bar">
        <a href="https://gorskifamilyoffice.com/gsi/index.html" class="logo-text">GSI<span class="logo-dot">.</span>Explorer</a>
        <div class="nav-links">
            <a href="https://gorskifamilyoffice.com/gsi/historical.html" class="nav-link">Historical Backtest</a>
            <a href="#" class="nav-link active">Projections (PSA)</a>
        </div>
    </nav>

    <div class="header">
        <div>
            <h1>Portfolio Strategy Analyzer <span style="font-size:0.5em; background:#f1f5f9; padding:4px 8px; border-radius:4px; vertical-align:middle;">Prototype</span></h1>
            <div class="sub">Total Return ETF vs Hedge Fund Structure</div>
        </div>
        <div style="text-align:right">
            <span id="displayBadge" class="gross-badge">Displaying: GROSS</span>
        </div>
    </div>

    <div class="kpi-grid">
        <div class="kpi">
            <div class="kpi-lbl">Your Capital</div>
            <div class="kpi-val" id="kpiCap">$0</div>
        </div>
        <div class="kpi" style="background:#f0fdf4; border-color:#bbf7d0;">
            <div class="kpi-lbl" style="color:#166534;">Total Notional Exposure</div>
            <div class="kpi-val" style="color:#15803d;" id="kpiNotional">$0</div>
        </div>
        <div class="kpi">
            <div class="kpi-lbl">Current NAV</div>
            <div class="kpi-val" id="kpiNav">$0</div>
        </div>
        <div class="kpi highlight">
            <div class="kpi-lbl">Projected Value (10Y)</div>
            <div class="kpi-val" id="kpiProj">$0</div>
        </div>
        <div class="kpi" style="background:#f8fafc; border-color:#94a3b8;">
            <div class="kpi-lbl">SPX ETF Return (10Y)</div>
            <div class="kpi-val" id="kpiSpxRet">$0</div>
        </div>
        <div class="kpi" id="kpiAlphaBox" style="background:#f0f9ff; border-color:#bae6fd;">
            <div class="kpi-lbl">Alpha (vs SPX ETF)</div>
            <div class="kpi-val" id="kpiAlpha">$0</div>
            <div class="kpi-subval" id="kpiAlphaPct">0.0%</div>
        </div>
    </div>

    <div class="dashboard">
        <div class="controls">
            <div class="inp-grp">
                <label style="margin-bottom:8px;">SPXFP Spot Price</label>
                <input type="number" id="inpSpot" value="580" step="0.50" onchange="updateDashboard()">
            </div>

            <div class="inp-grp">
                <label style="margin-bottom:8px;">Your Investment Capital ($)</label>
                <input type="number" id="inpInv" value="250000" step="10000" onchange="updateDashboard()">
            </div>

            <div class="fee-section">
                <div class="fee-header">
                    <span class="fee-title">FEES & NET RETURNS</span>
                    <label class="switch">
                        <input type="checkbox" id="checkFees" onchange="toggleFees()">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div id="feeControls" style="opacity:0.5; pointer-events:none; transition: opacity 0.3s;">
                    <div class="inp-grp">
                        <label>Carry Fee (On Withdrawal)</label>
                        <select id="selCarry" onchange="updateDashboard()">
                            <option value="0">0%</option>
                            <option value="10">10%</option>
                            <option value="20" selected>20%</option>
                        </select>
                    </div>
                    <div class="inp-grp" style="margin-bottom:0;">
                        <div class="inp-header">
                            <label>Management Fee (Annual)</label>
                            <span class="inp-val" id="valMgmt">0.5%</span>
                        </div>
                        <input type="range" id="inpMgmt" min="0" max="2" step="0.5" value="0.5" oninput="updateVal('valMgmt', this.value); updateDashboard()">
                    </div>
                </div>
            </div>

            <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">

            <div class="inp-grp">
                <div class="inp-header">
                    <label>S&P 500 Price Return</label>
                    <div style="display:flex; align-items:center;">
                        <span class="inp-val" id="valMkt" style="margin-right:10px;">12.0%</span>
                        <button class="btn-mini" onclick="openHistModal()">üìú View 50Y History</button>
                    </div>
                </div>
                <input type="range" id="inpMkt" min="-50" max="50" step="0.5" value="12" oninput="updateVal('valMkt', this.value); updateDashboard()">
            </div>

            <div class="inp-grp">
                <div class="inp-header">
                    <label>S&P 500 Dividend Yield</label>
                    <span class="inp-val" id="valDiv">1.1%</span>
                </div>
                <input type="range" id="inpDiv" min="0" max="5" step="0.1" value="1.1" oninput="updateVal('valDiv', this.value); updateDashboard()">
            </div>

            <div class="inp-grp">
                <div class="inp-header">
                    <label>Credit Yield</label>
                    <span class="inp-val" id="valBcred">9.5%</span>
                </div>
                <input type="range" id="inpBcred" min="5" max="15" step="0.5" value="9.5" oninput="updateVal('valBcred', this.value); updateDashboard()">
            </div>

            <div class="inp-grp">
                <div class="inp-header">
                    <label>Implied Volatility</label>
                    <span class="inp-val" id="valVol">22%</span>
                </div>
                <input type="range" id="inpVol" min="10" max="50" step="1" value="22" oninput="updateVal('valVol', this.value); updateDashboard()">
            </div>            
            
            <div style="margin-top:20px; font-size:0.8rem; color:#475569; line-height:1.6; background:#f8fafc; padding:15px; border-radius:8px; border:1px solid #e2e8f0;">
                <strong style="color:var(--primary); display:block; margin-bottom:5px;">Definitions:</strong>
                <ul style="padding-left:16px; margin:0;">
                    <li style="margin-bottom:6px;"><strong>NAV Value:</strong> Combined value of Credit + Options.</li>
                    <li><strong>Static Return:</strong> The theoretical <em>Intrinsic Value</em> of the option leg. Starts at $0 and grows to meet the full Option Value at maturity.</li>
                </ul>
            </div>
        </div>

        <div>
            <div class="chart-container">
                <div class="chart-tools">
                    <button class="btn-mini" onclick="resetZoom()">Reset Zoom</button>
                </div>
                <canvas id="chartWealth"></canvas>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>Asset Class (10Y Projection)</th>
                        <th>Initial Investment</th>
                        <th>Final Value</th>
                        <th>Total Return</th>
                        <th>CAGR / IRR</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>
</div>

<div id="histModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeHistModal()">&times;</span>
        <h2 style="margin-top:0; color:#0f172a;">50-Year Market Returns (Educational)</h2>
        <div style="font-size:0.85rem; color:#64748b; margin-bottom:20px;">Select an asset class on the left to view annual returns 1974-2024.</div>
        
        <div class="hist-grid">
            <div>
                <button class="asset-btn active" onclick="switchHistChart('SPX', this)">
                    <span>üá∫üá∏ S&P 500 (Price Return)</span>
                    <span class="asset-ret" style="color:#10b981;">9.2%</span>
                </button>
                <button class="asset-btn" onclick="switchHistChart('PE', this)">
                    <span>üè¢ Private Equity</span>
                    <span class="asset-ret" style="color:#8b5cf6;">14.1%</span>
                </button>
                <button class="asset-btn" onclick="switchHistChart('BONDS', this)">
                    <span>üìâ US Bonds (Agg)</span>
                    <span class="asset-ret" style="color:#3b82f6;">6.2%</span>
                </button>
                <button class="asset-btn" onclick="switchHistChart('GOLD', this)">
                    <span>ü•á Gold</span>
                    <span class="asset-ret" style="color:#f59e0b;">7.8%</span>
                </button>
            </div>
            <div>
                <h3 id="histChartTitle" style="margin-top:0;">S&P 500 Annual Returns (Price Only)</h3>
                <div style="height:350px;">
                    <canvas id="chartModal"></canvas>
                </div>
            </div>
        </div>
        <div style="margin-top:20px; padding:10px; background:#fef2f2; color:#991b1b; border:1px solid #fecaca; border-radius:6px; font-size:0.85rem;">
            <strong>Disclaimer:</strong> Data may not be fully accurate and is intended for educational demonstrations only. Please verify with official sources.
        </div>
    </div>
</div>

<script>
    // --- UI Helpers ---
    const fmt = (n) => new Intl.NumberFormat('en-US', { style:'currency', currency:'USD', maximumFractionDigits:0 }).format(n);
    function updateVal(id, val) { document.getElementById(id).innerText = val + '%'; }
    
    // --- Chart Globals ---
    let chartWealth = null;

    // --- Main Logic: Wire UI to External Calculator ---
    function updateDashboard() {
        // 1. Gather Inputs
        const inv = parseFloat(document.getElementById('inpInv').value);
        const spot = parseFloat(document.getElementById('inpSpot').value);
        const useFees = document.getElementById('checkFees').checked;
        
        const inputs = {
            investment: inv,
            currentSpot: spot, 
            spxPriceReturn: parseFloat(document.getElementById('inpMkt').value),
            spxDivYield: parseFloat(document.getElementById('inpDiv').value),
            creditYield: parseFloat(document.getElementById('inpBcred').value),
            volatility: parseFloat(document.getElementById('inpVol').value),
            mgmtFee: useFees ? parseFloat(document.getElementById('inpMgmt').value) : 0,
            carryFee: useFees ? parseFloat(document.getElementById('selCarry').value) : 0,
            riskFreeRate: 4.0,
            years: 10
        };

        // 2. Call External Logic
        const data = calculateGSIProjection(inputs);
        const series = data.series;
        const metrics = data.metrics;

        // 3. Update KPI Grid
        document.getElementById('kpiCap').innerText = fmt(inv);
        document.getElementById('kpiNotional').innerText = fmt(metrics.initialNotional);
        document.getElementById('kpiNav').innerText = fmt(series.gsi[0]);
        document.getElementById('kpiProj').innerText = fmt(metrics.finalValue);
        
        const finalSpx = series.spx[series.spx.length-1];
        document.getElementById('kpiSpxRet').innerText = fmt(finalSpx);

        const alpha = metrics.finalValue - finalSpx;
        const alphaPct = ((metrics.finalValue / finalSpx) - 1) * 100;
        
        const alphaBox = document.getElementById('kpiAlphaBox');
        const alphaTxt = document.getElementById('kpiAlpha');
        const alphaSub = document.getElementById('kpiAlphaPct');
        
        alphaTxt.innerText = (alpha >= 0 ? "+" : "") + fmt(alpha);
        alphaSub.innerText = (alphaPct >= 0 ? "+" : "") + alphaPct.toFixed(1) + "%";
        
        if (alpha >= 0) {
            alphaBox.style.background = '#f0fdf4'; alphaBox.style.borderColor = '#bbf7d0';
            alphaTxt.style.color = '#166534'; alphaSub.style.color = '#166534';
        } else {
            alphaBox.style.background = '#fef2f2'; alphaBox.style.borderColor = '#fecaca';
            alphaTxt.style.color = '#dc2626'; alphaSub.style.color = '#dc2626';
        }

        // 4. Update Charts
        renderWealthChart(series.labels, series.gsi, series.spx, series.credit, series.options, series.static);

        // 5. Update Table
        updateTable(inv, metrics.finalValue, finalSpx, series.pe[series.pe.length-1], series.bonds[series.bonds.length-1]);
    }

    function updateTable(initial, gsiFinal, spxFinal, peFinal, bondFinal) {
        const row = (name, final) => {
            const ret = ((final/initial)-1)*100;
            const irr = (Math.pow(final/initial, 0.1)-1)*100;
            return `<tr>
                <td style="text-align:left; font-weight:600;">${name}</td>
                <td>${fmt(initial)}</td>
                <td>${fmt(final)}</td>
                <td style="color:${ret>=0?'#166534':'#dc2626'}">${ret.toFixed(1)}%</td>
                <td>${irr.toFixed(1)}%</td>
            </tr>`;
        };

        const html = 
            row('GSI Strategy', gsiFinal) +
            row('S&P 500 ETF', spxFinal) +
            row('Private Equity (Proxy)', peFinal) +
            row('US Agg Bonds', bondFinal);
            
        document.getElementById('tableBody').innerHTML = html;
    }

    // --- Chart Rendering ---
    function renderWealthChart(labels, gsi, spx, credit, options, stat) {
        const ctx = document.getElementById('chartWealth').getContext('2d');
        if(chartWealth) chartWealth.destroy();
        
        chartWealth = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    { label: 'GSI Strategy', data: gsi, borderColor: '#0f172a', backgroundColor: 'rgba(15, 23, 42, 0.05)', borderWidth: 3, fill: true, pointRadius: 0 },
                    { label: 'S&P 500 ETF', data: spx, borderColor: '#94a3b8', borderWidth: 2, borderDash: [5, 5], pointRadius: 0 },
                    // Hidden components by default, toggleable via legend
                    { label: 'Credit Floor', data: credit, borderColor: '#10b981', borderWidth: 1, pointRadius: 0, hidden: true },
                    { label: 'Option Value', data: options, borderColor: '#ef4444', borderWidth: 1, pointRadius: 0, hidden: true },
                    { label: 'Intrinsic Value', data: stat, borderColor: '#9333ea', borderWidth: 1, borderDash: [2,2], pointRadius: 0, hidden: true }
                ]
            },
            options: commonChartOptions('$')
        });
    }

    function commonChartOptions(format) {
        return {
            responsive: true,
            maintainAspectRatio: false,
            interaction: { mode: 'index', intersect: false },
            scales: {
                x: { grid: { display: false } },
                y: { 
                    grid: { color: '#f1f5f9' },
                    ticks: { callback: (v) => format==='$' ? (v>=1000000 ? '$'+(v/1000000).toFixed(1)+'M' : '$'+(v/1000).toFixed(0)+'k') : v }
                }
            },
            plugins: {
                zoom: { zoom: { wheel: { enabled: true }, drag: { enabled: true }, mode: 'x' } },
                legend: { position: 'top' },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.dataset.label + ': ' + fmt(context.raw);
                        }
                    }
                }
            }
        };
    }

    function toggleFees() {
        const checked = document.getElementById('checkFees').checked;
        const panel = document.getElementById('feeControls');
        const badge = document.getElementById('displayBadge');
        
        if (checked) {
            panel.style.opacity = '1';
            panel.style.pointerEvents = 'auto';
            badge.innerText = 'Displaying: NET';
            badge.className = 'net-badge';
        } else {
            panel.style.opacity = '0.5';
            panel.style.pointerEvents = 'none';
            badge.innerText = 'Displaying: GROSS';
            badge.className = 'gross-badge';
        }
        updateDashboard();
    }

    function resetZoom() {
        if(chartWealth) chartWealth.resetZoom();
    }

    // Init
    window.onload = updateDashboard;


    // ====================================================================
    // ADDED: HARDCODED DATA FOR HISTORICAL BUTTON & MODAL ONLY
    // ====================================================================
    
    // Hardcoded Arrays (50Y)
    const SPX_PRICE_50Y = [ -29.7, 31.5, 19.1, -11.5, 1.1, 12.3, 25.8, -9.7, 14.8, 17.3, 1.4, 26.3, 14.6, 2.0, 12.4, 27.3, -6.6, 26.3, 4.5, 7.1, -1.5, 34.1, 20.3, 31.0, 26.7, 19.5, -10.1, -13.0, -23.4, 26.4, 9.0, 3.0, 13.6, 3.5, -38.5, 23.5, 12.8, 0.0, 13.4, 29.6, 11.4, -0.7, 9.5, 19.4, -6.2, 28.9, 16.3, 26.9, -19.4, 24.2, 24.0 ];
    const BONDS_50Y = [ 5.2, 7.8, 15.6, 3.0, 1.4, 2.3, 2.7, 6.3, 32.6, 8.4, 15.1, 22.1, 15.3, 2.8, 7.9, 14.5, 8.9, 16.0, 7.4, 9.7, -2.9, 18.5, 3.6, 9.7, 8.7, -0.8, 11.6, 8.4, 10.3, 4.1, 4.3, 2.4, 4.3, 7.0, 5.2, 5.9, 6.5, 7.8, 4.2, -2.0, 6.0, 0.5, 2.6, 3.5, 0.0, 8.7, 7.5, -1.5, -13.0, 5.5, 4.5 ];
    const GOLD_50Y = [ 72.0, -25.0, -4.0, 23.0, 37.0, 126.0, 12.5, -32.0, -13.0, -15.0, -19.0, 6.0, 20.0, 24.0, -15.0, -2.0, -2.0, -10.0, -6.0, 17.0, -2.0, 1.0, -4.0, -21.0, -1.0, -1.0, -6.0, 1.0, 24.0, 20.0, 5.0, 18.0, 23.0, 31.0, 5.0, 24.0, 29.0, 10.0, 7.0, -28.0, -1.0, -10.0, 8.0, 13.0, -1.0, 18.0, 25.0, -3.0, -0.3, 13.1, 25.0 ];
    const PE_50Y = [ 12.5, 18.2, 28.4, 12.1, 15.0, 20.2, 28.5, 2.1, 19.3, 18.2, 10.5, 29.4, 17.8, 8.2, 18.5, 25.1, 4.2, 32.1, 12.3, 15.6, 9.2, 45.2, 28.3, 35.1, 22.4, 30.2, -0.5, -12.2, -1.8, 32.4, 15.6, 26.2, 22.8, 17.2, -26.4, 14.1, 23.8, 9.8, 14.5, 21.6, 13.2, 6.8, 11.2, 19.8, 10.1, 18.6, 23.4, 39.0, -4.2, 5.8, 10.0 ];

    const HIST_YEARS = Array.from({length: 51}, (_, i) => 1974 + i);
    const ASSET_DATA = {
        'SPX': { label: 'S&P 500 (Price Return)', color: '#10b981', data: SPX_PRICE_50Y },
        'PE': { label: 'Private Equity (Proxy)', color: '#8b5cf6', data: PE_50Y },
        'BONDS': { label: 'US Bonds (Agg)', color: '#3b82f6', data: BONDS_50Y },
        'GOLD': { label: 'Gold', color: '#f59e0b', data: GOLD_50Y }
    };

    let chartModal = null;

    function openHistModal() {
        document.getElementById('histModal').style.display = 'block';
        setTimeout(() => switchHistChart('SPX', document.querySelector('.asset-btn')), 100);
    }
    
    function closeHistModal() {
        document.getElementById('histModal').style.display = 'none';
    }
    
    // Close modal if clicking outside
    window.onclick = function(event) {
        if (event.target == document.getElementById('histModal')) {
            closeHistModal();
        }
    }

    function switchHistChart(key, btn) {
        document.querySelectorAll('.asset-btn').forEach(b => b.classList.remove('active'));
        if(btn) btn.classList.add('active');

        const asset = ASSET_DATA[key];
        document.getElementById('histChartTitle').innerText = `${asset.label} Annual Returns (1974-2024)`;

        const ctx = document.getElementById('chartModal').getContext('2d');
        if(chartModal) chartModal.destroy();

        chartModal = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: HIST_YEARS,
                datasets: [{
                    label: 'Annual Return (%)',
                    data: asset.data,
                    backgroundColor: asset.data.map(v => v >= 0 ? asset.color : '#ef4444'),
                    borderRadius: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: { 
                    y: { grid: { color: '#f1f5f9' }, title: { display:true, text:'Return %' } }, 
                    x: { grid: { display:false }, ticks:{ maxTicksLimit: 10 } } 
                },
                plugins: { legend: {display:false} }
            }
        });
    }
</script>

</body>
</html>
